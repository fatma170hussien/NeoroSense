<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NeuroSense - Interactive Dashboard</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --primary-color: #6a11cb;
      --secondary-color: #2575fc;
      --accent-color: #4a00e0;
      --text-color: #333;
      --light-text: #fff;
      --card-bg: #fff;
      --header-bg: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
      --footer-bg: #e3e6ea;
      --section-bg: #f4f6f9;
      --featured-card-bg: linear-gradient(135deg, #6a11cb, #2575fc);
      --button-bg: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
      --button-hover: linear-gradient(90deg, var(--secondary-color), var(--primary-color));
      --success-color: #28a745;
      --warning-color: #ffc107;
      --danger-color: #dc3545;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    body {
      background: var(--section-bg);
      color: var(--text-color);
      overflow-x: hidden;
    }
    
    header {
      background: var(--header-bg);
      color: var(--light-text);
      padding: 15px 5%;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      position: sticky;
      top: 0;
      z-index: 100;
    }
    
    .logo {
      display: flex;
      align-items: center;
      font-size: 1.5rem;
      font-weight: bold;
    }
    
    .logo i {
      margin-right: 10px;
      font-size: 1.8rem;
    }
    
    nav ul {
      display: flex;
      list-style: none;
    }
    
    nav ul li {
      margin-left: 20px;
    }
    
    nav ul li a {
      color: var(--light-text);
      text-decoration: none;
      font-weight: 500;
      transition: all 0.3s;
      display: flex;
      align-items: center;
    }
    
    nav ul li a:hover {
      opacity: 0.9;
      transform: translateY(-2px);
    }
    
    nav ul li a.active {
      border-bottom: 2px solid white;
    }
    
    nav ul li a i {
      margin-right: 5px;
    }
    
    .user-profile {
      display: flex;
      align-items: center;
      cursor: pointer;
      position: relative;
    }
    
    .user-profile img {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      margin-right: 10px;
      object-fit: cover;
      border: 2px solid rgba(255, 255, 255, 0.3);
    }
    
    .dropdown-menu {
      position: absolute;
      top: 50px;
      right: 0;
      background: var(--card-bg);
      border-radius: 8px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      width: 200px;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s;
      z-index: 100;
    }
    
    .dropdown-menu.active {
      opacity: 1;
      visibility: visible;
      transform: translateY(5px);
    }
    
    .dropdown-menu a {
      display: block;
      padding: 10px 15px;
      color: var(--text-color);
      text-decoration: none;
      transition: all 0.3s;
    }
    
    .dropdown-menu a:hover {
      background: #f5f5f5;
      color: var(--primary-color);
    }
    
    .dropdown-menu a i {
      margin-right: 10px;
      width: 20px;
      text-align: center;
    }
    
    .dashboard-container {
      padding: 30px 5%;
    }
    
    .dashboard-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
    }
    
    .dashboard-header h1 {
      font-size: 2.2rem;
      color: var(--primary-color);
    }
    
    .date-filter {
      display: flex;
      gap: 10px;
    }
    
    .date-filter select {
      padding: 8px 15px;
      border: 1px solid #ddd;
      border-radius: 5px;
      background: white;
    }
    
    .stats-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .stat-card {
      background: var(--card-bg);
      border-radius: 10px;
      padding: 25px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
      display: flex;
      flex-direction: column;
      position: relative;
      overflow: hidden;
      transition: transform 0.3s, box-shadow 0.3s;
    }
    
    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    }
    
    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 5px;
      background: var(--button-bg);
    }
    
    .stat-card i {
      font-size: 2.5rem;
      margin-bottom: 15px;
      color: var(--primary-color);
    }
    
    .stat-card h3 {
      font-size: 1.1rem;
      margin-bottom: 10px;
      color: #666;
    }
    
    .stat-card .value {
      font-size: 2rem;
      font-weight: bold;
      margin-bottom: 5px;
    }
    
    .stat-card .trend {
      font-size: 0.9rem;
      display: flex;
      align-items: center;
    }
    
    .trend.up {
      color: var(--success-color);
    }
    
    .trend.down {
      color: var(--danger-color);
    }
    
    .dashboard-grid {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 25px;
    }
    
    .chart-container, .recent-activity, .mood-tracker, .goals {
      background: var(--card-bg);
      border-radius: 10px;
      padding: 25px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
      transition: transform 0.3s, box-shadow 0.3s;
    }
    
    .chart-container:hover, .recent-activity:hover, .mood-tracker:hover, .goals:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
    }
    
    .chart-container h2, .recent-activity h2, .mood-tracker h2, .goals h2 {
      font-size: 1.5rem;
      margin-bottom: 20px;
      color: var(--primary-color);
      display: flex;
      align-items: center;
    }
    
    .chart-container h2 i, .recent-activity h2 i, .mood-tracker h2 i, .goals h2 i {
      margin-right: 10px;
    }
    
    .chart-wrapper {
      height: 300px;
      position: relative;
    }
    
    .activity-list {
      list-style: none;
    }
    
    .activity-item {
      display: flex;
      align-items: center;
      padding: 15px 0;
      border-bottom: 1px solid #eee;
      transition: background 0.3s;
    }
    
    .activity-item:hover {
      background: #f9f9f9;
    }
    
    .activity-item:last-child {
      border-bottom: none;
    }
    
    .activity-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--section-bg);
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 15px;
      color: var(--primary-color);
    }
    
    .activity-details {
      flex: 1;
    }
    
    .activity-title {
      font-weight: 600;
      margin-bottom: 5px;
    }
    
    .activity-time {
      font-size: 0.85rem;
      color: #666;
    }
    
    .mood-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 10px;
      margin-bottom: 20px;
    }
    
    .mood-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 15px 10px;
      border-radius: 10px;
      background: var(--section-bg);
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .mood-item:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
    }
    
    .mood-item.active {
      background: var(--primary-color);
      color: white;
    }
    
    .mood-item i {
      font-size: 1.5rem;
      margin-bottom: 8px;
    }
    
    .mood-item span {
      font-size: 0.8rem;
      text-align: center;
    }
    
    .mood-history {
      margin-top: 20px;
    }
    
    .mood-history h3 {
      font-size: 1.1rem;
      margin-bottom: 15px;
      color: var(--primary-color);
    }
    
    .mood-history-chart {
      height: 150px;
    }
    
    .goal-item {
      display: flex;
      align-items: center;
      padding: 15px 0;
      border-bottom: 1px solid #eee;
      transition: background 0.3s;
    }
    
    .goal-item:hover {
      background: #f9f9f9;
    }
    
    .goal-item:last-child {
      border-bottom: none;
    }
    
    .goal-checkbox {
      margin-right: 15px;
    }
    
    .goal-details {
      flex: 1;
    }
    
    .goal-title {
      font-weight: 600;
      margin-bottom: 5px;
    }
    
    .goal-progress {
      display: flex;
      align-items: center;
      margin-top: 8px;
    }
    
    .progress-bar {
      flex: 1;
      height: 8px;
      background: #e9ecef;
      border-radius: 4px;
      overflow: hidden;
      margin-right: 10px;
    }
    
    .progress-fill {
      height: 100%;
      background: var(--primary-color);
      border-radius: 4px;
      transition: width 0.5s ease;
    }
    
    .progress-text {
      font-size: 0.8rem;
      color: #666;
    }
    
    .dashboard-actions {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-top: 30px;
    }
    
    .action-card {
      background: var(--card-bg);
      border-radius: 10px;
      padding: 25px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
      text-align: center;
      transition: all 0.3s;
      cursor: pointer;
    }
    
    .action-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    }
    
    .action-card i {
      font-size: 2.5rem;
      margin-bottom: 15px;
      color: var(--primary-color);
    }
    
    .action-card h3 {
      font-size: 1.2rem;
      margin-bottom: 10px;
    }
    
    .action-card p {
      font-size: 0.9rem;
      color: #666;
    }
    
    footer {
      text-align: center;
      padding: 20px;
      background: var(--footer-bg);
      margin-top: 50px;
    }
    
    .footer-links {
      display: flex;
      justify-content: center;
      margin-bottom: 15px;
    }
    
    .footer-links a {
      color: var(--text-color);
      margin: 0 15px;
      text-decoration: none;
      transition: all 0.3s;
    }
    
    .footer-links a:hover {
      color: var(--primary-color);
    }
    
    .copyright {
      font-size: 0.9rem;
      color: #666;
    }
    
    /* زر الشات بوت الأزرق الصغير فقط */
    .chatbase-chatbot {
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 999;
    }
    
    .chatbase-toggle {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: var(--button-bg);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      transition: all 0.3s ease;
      border: none;
      z-index: 1000;
    }
    
    .chatbase-toggle:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.25);
      background: var(--button-hover);
    }
    
    .chatbase-toggle.pulse {
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0% {
        box-shadow: 0 0 0 0 rgba(106, 17, 203, 0.7);
      }
      70% {
        box-shadow: 0 0 0 10px rgba(106, 17, 203, 0);
      }
      100% {
        box-shadow: 0 0 0 0 rgba(106, 17, 203, 0);
      }
    }
    
    /* Progress Level Indicator */
    .progress-level {
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 20px 0;
      padding: 15px;
      background: var(--card-bg);
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
    }
    
    .level-indicator {
      text-align: center;
      padding: 0 20px;
    }
    
    .level-indicator h3 {
      color: var(--primary-color);
      margin-bottom: 10px;
    }
    
    .level-badge {
      display: inline-block;
      padding: 8px 15px;
      background: var(--button-bg);
      color: white;
      border-radius: 20px;
      font-weight: bold;
      margin-top: 10px;
    }
    
    .level-progress {
      flex: 1;
      max-width: 400px;
    }
    
    .level-progress h4 {
      margin-bottom: 10px;
      color: var(--primary-color);
    }
    
    .level-bar {
      height: 15px;
      background: #e9ecef;
      border-radius: 10px;
      overflow: hidden;
      margin-bottom: 10px;
    }
    
    .level-fill {
      height: 100%;
      background: var(--button-bg);
      border-radius: 10px;
      transition: width 0.8s ease;
    }
    
    .level-stats {
      display: flex;
      justify-content: space-between;
      font-size: 0.9rem;
      color: #666;
    }
    
    /* Achievement Badges */
    .achievements {
      margin-top: 30px;
    }
    
    .achievements h2 {
      font-size: 1.5rem;
      margin-bottom: 20px;
      color: var(--primary-color);
      display: flex;
      align-items: center;
    }
    
    .achievements h2 i {
      margin-right: 10px;
    }
    
    .badge-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 15px;
    }
    
    .badge {
      background: var(--card-bg);
      border-radius: 10px;
      padding: 15px;
      text-align: center;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
      transition: all 0.3s;
    }
    
    .badge:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    }
    
    .badge i {
      font-size: 2rem;
      margin-bottom: 10px;
      color: var(--primary-color);
    }
    
    .badge.locked i {
      color: #ccc;
    }
    
    .badge h4 {
      font-size: 0.9rem;
      margin-bottom: 5px;
    }
    
    .badge p {
      font-size: 0.7rem;
      color: #666;
    }
    
    /* Responsive adjustments */
    @media (max-width: 1024px) {
      .dashboard-grid {
        grid-template-columns: 1fr;
      }
      
      .progress-level {
        flex-direction: column;
        text-align: center;
      }
      
      .level-progress {
        width: 100%;
        margin-top: 15px;
      }
    }
    
    @media (max-width: 768px) {
      header {
        flex-direction: column;
        padding: 15px;
      }
      
      .logo {
        margin-bottom: 15px;
      }
      
      nav ul {
        flex-wrap: wrap;
        justify-content: center;
      }
      
      nav ul li {
        margin: 5px 10px;
      }
      
      .dashboard-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 15px;
      }
      
      .date-filter {
        width: 100%;
        justify-content: flex-end;
      }
      
      .mood-grid {
        grid-template-columns: repeat(3, 1fr);
      }
      
      .badge-container {
        grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      }
    }
    
    @media (max-width: 480px) {
      .stats-cards {
        grid-template-columns: 1fr;
      }
      
      .mood-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .dashboard-actions {
        grid-template-columns: 1fr;
      }
      
      .badge-container {
        grid-template-columns: repeat(2, 1fr);
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="logo">
      <i class="fas fa-brain"></i>
      <span>NeuroSense</span>
    </div>
    
    <nav>
      <ul>
        <li><a href="home.html"><i class="fas fa-home"></i> Home</a></li>
        <li><a href="dashboard.html" class="active"><i class="fas fa-chart-line"></i> Dashboard</a></li>
        <li><a href="citation.html"><i class="fas fa-book"></i> Resources</a></li>
        <li><a href="appiont.html"><i class="fas fa-calendar-alt"></i> Appointments</a></li>
      </ul>
    </nav>
    
    <div class="user-profile" id="userProfile">
      <img src="https://ui-avatars.com/api/?name=User+Name&background=random" alt="User" id="profileImage">
      <span id="profileName">User</span>
      <div class="dropdown-menu" id="dropdownMenu">
        <a href="#" id="profileBtn"><i class="fas fa-user"></i> Profile</a>
        <a href="#" id="settingsBtn"><i class="fas fa-cog"></i> Settings</a>
        <a href="#" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> Logout</a>
      </div>
    </div>
  </header>

  <div class="dashboard-container">
    <div class="dashboard-header">
      <h1>Mental Health Dashboard</h1>
      <div class="date-filter">
        <select id="timeRange">
          <option value="7">Last 7 Days</option>
          <option value="30" selected>Last 30 Days</option>
          <option value="90">Last 3 Months</option>
          <option value="365">Last Year</option>
        </select>
      </div>
    </div>
    
    <!-- Progress Level Indicator -->
    <div class="progress-level">
      <div class="level-indicator">
        <h3>Your Progress Level</h3>
        <div class="level-badge" id="levelBadge">Beginner</div>
      </div>
      <div class="level-progress">
        <h4>Next Level: <span id="nextLevel">Intermediate</span></h4>
        <div class="level-bar">
          <div class="level-fill" id="levelFill" style="width: 30%"></div>
        </div>
        <div class="level-stats">
          <span id="currentXP">150 XP</span>
          <span id="nextLevelXP">500 XP for next level</span>
        </div>
      </div>
    </div>
    
    <div class="stats-cards">
      <div class="stat-card">
        <i class="fas fa-heartbeat"></i>
        <h3>Mental Wellness Score</h3>
        <div class="value" id="wellnessScore">78/100</div>
        <div class="trend up" id="wellnessTrend">
          <i class="fas fa-arrow-up"></i> 5% improvement
        </div>
      </div>
      
      <div class="stat-card">
        <i class="fas fa-check-circle"></i>
        <h3>Completed Exercises</h3>
        <div class="value" id="completedExercises">12</div>
        <div class="trend up" id="exercisesTrend">
          <i class="fas fa-arrow-up"></i> 3 this week
        </div>
      </div>
      
      <div class="stat-card">
        <i class="fas fa-bed"></i>
        <h3>Sleep Quality</h3>
        <div class="value" id="sleepQuality">6.5h avg</div>
        <div class="trend down" id="sleepTrend">
          <i class="fas fa-arrow-down"></i> 0.5h less
        </div>
      </div>
      
      <div class="stat-card">
        <i class="fas fa-calendar-check"></i>
        <h3>Consistency Streak</h3>
        <div class="value" id="consistencyStreak">7 days</div>
        <div class="trend up" id="streakTrend">
          <i class="fas fa-fire"></i> Keep going!
        </div>
      </div>
    </div>
    
    <div class="dashboard-grid">
      <div class="chart-container">
        <h2><i class="fas fa-chart-line"></i> Mood & Progress Tracking</h2>
        <div class="chart-wrapper">
          <canvas id="progressChart"></canvas>
        </div>
      </div>
      
      <div class="recent-activity">
        <h2><i class="fas fa-history"></i> Recent Activity</h2>
        <ul class="activity-list" id="activityList">
          <!-- سيتم ملؤه بالبيانات الفعلية -->
        </ul>
      </div>
    </div>
    
    <div class="dashboard-grid" style="margin-top: 25px;">
      <div class="mood-tracker">
        <h2><i class="fas fa-smile"></i> Today's Mood</h2>
        <div class="mood-grid">
          <div class="mood-item" data-mood="excellent">
            <i class="fas fa-grin-beam"></i>
            <span>Excellent</span>
          </div>
          <div class="mood-item" data-mood="good">
            <i class="fas fa-smile"></i>
            <span>Good</span>
          </div>
          <div class="mood-item" data-mood="neutral">
            <i class="fas fa-meh"></i>
            <span>Neutral</span>
          </div>
          <div class="mood-item" data-mood="poor">
            <i class="fas fa-frown"></i>
            <span>Poor</span>
          </div>
          <div class="mood-item" data-mood="very-poor">
            <i class="fas fa-sad-tear"></i>
            <span>Very Poor</span>
          </div>
        </div>
        
        <div class="mood-history">
          <h3>Mood History</h3>
          <div class="mood-history-chart">
            <canvas id="moodChart"></canvas>
          </div>
        </div>
      </div>
      
      <div class="goals">
        <h2><i class="fas fa-bullseye"></i> Weekly Goals</h2>
        <div id="goalsList">
          <!-- سيتم ملؤه بالبيانات الفعلية -->
        </div>
      </div>
    </div>
    
    <!-- Achievements Section -->
    <div class="achievements">
      <h2><i class="fas fa-trophy"></i> Your Achievements</h2>
      <div class="badge-container" id="badgeContainer">
        <!-- سيتم ملؤه بالبيانات الفعلية -->
      </div>
    </div>
    
    <div class="dashboard-actions">
      <div class="action-card" onclick="location.href='bel.html'">
        <i class="fas fa-stethoscope"></i>
        <h3>Health Check</h3>
        <p>Take a quick mental health assessment</p>
      </div>
      
      <div class="action-card" onclick="location.href='ex.ther.html'">
        <i class="fas fa-spa"></i>
        <h3>Therapy Exercises</h3>
        <p>Practice CBT and mindfulness techniques</p>
      </div>
      
      <div class="action-card" onclick="location.href='mental.html'">
        <i class="fas fa-book"></i>
        <h3>Resources</h3>
        <p>Explore mental health library</p>
      </div>
      
      <div class="action-card" onclick="location.href='prof.html'">
        <i class="fas fa-user-md"></i>
        <h3>Professional Help</h3>
        <p>Connect with mental health specialists</p>
      </div>
    </div>
  </div>

  <footer>
    <div class="footer-links">
      <a href="home.html#about-us">About Us</a>
      <a href="#">Contact</a>
      <a href="#">Privacy Policy</a>
    </div>
    <p class="copyright">© 2025 NeuroSense. All rights reserved.</p>
  </footer>

  <!-- زر الشات بوت الأزرق الصغير فقط -->
  <div class="chatbase-chatbot">
    <button class="chatbase-toggle pulse" id="chatbaseToggle" aria-label="Open Chatbot">
      <i class="fas fa-robot"></i>
    </button>
  </div>

  <script>
    // نظام التقدم الديناميكي
    const progressSystem = {
      levels: [
        { name: "Beginner", xpRequired: 0, badge: "fas fa-seedling" },
        { name: "Intermediate", xpRequired: 500, badge: "fas fa-leaf" },
        { name: "Advanced", xpRequired: 1200, badge: "fas fa-tree" },
        { name: "Expert", xpRequired: 2500, badge: "fas fa-award" },
        { name: "Master", xpRequired: 5000, badge: "fas fa-crown" }
      ],
      
      achievements: [
        { id: 1, name: "First Steps", description: "Complete your first activity", icon: "fas fa-footsteps", xp: 50, unlocked: false },
        { id: 2, name: "Mood Tracker", description: "Track your mood for 7 consecutive days", icon: "fas fa-smile", xp: 100, unlocked: false },
        { id: 3, name: "Consistency", description: "Use the platform for 14 days in a row", icon: "fas fa-calendar-check", xp: 150, unlocked: false },
        { id: 4, name: "Goal Getter", description: "Complete all weekly goals", icon: "fas fa-bullseye", xp: 200, unlocked: false },
        { id: 5, name: "Wellness Warrior", description: "Reach a wellness score of 80+", icon: "fas fa-heart", xp: 250, unlocked: false },
        { id: 6, name: "Meditation Master", description: "Complete 10 meditation sessions", icon: "fas fa-spa", xp: 150, unlocked: false },
        { id: 7, name: "Knowledge Seeker", description: "Read 5 mental health articles", icon: "fas fa-book", xp: 100, unlocked: false },
        { id: 8, name: "Community Helper", description: "Share your progress with others", icon: "fas fa-users", xp: 100, unlocked: false }
      ],
      
      // حساب المستوى الحالي بناءً على XP
      getCurrentLevel(xp) {
        for (let i = this.levels.length - 1; i >= 0; i--) {
          if (xp >= this.levels[i].xpRequired) {
            return {
              level: i,
              name: this.levels[i].name,
              badge: this.levels[i].badge,
              nextLevel: i < this.levels.length - 1 ? this.levels[i + 1] : null,
              progress: i < this.levels.length - 1 ? 
                (xp - this.levels[i].xpRequired) / (this.levels[i + 1].xpRequired - this.levels[i].xpRequired) : 1
            };
          }
        }
        return {
          level: 0,
          name: this.levels[0].name,
          badge: this.levels[0].badge,
          nextLevel: this.levels[1],
          progress: xp / this.levels[1].xpRequired
        };
      },
      
      // تحديث الإنجازات
      updateAchievements(userData) {
        const achievements = [...this.achievements];
        
        // First Steps - Complete any activity
        if (userData.activities && userData.activities.length > 0) {
          achievements[0].unlocked = true;
        }
        
        // Mood Tracker - Track mood for 7 consecutive days
        if (userData.moodData && Object.keys(userData.moodData).length >= 7) {
          achievements[1].unlocked = true;
        }
        
        // Consistency - Use platform for 14 consecutive days
        if (userData.consistencyStreak >= 14) {
          achievements[2].unlocked = true;
        }
        
        // Goal Getter - Complete all weekly goals
        if (userData.goals && userData.goals.every(goal => goal.checked)) {
          achievements[3].unlocked = true;
        }
        
        // Wellness Warrior - Reach wellness score of 80+
        if (userData.wellnessScore >= 80) {
          achievements[4].unlocked = true;
        }
        
        return achievements;
      }
    };

    // بيانات أولية في حالة عدم وجود بيانات مخزنة
    const defaultDashboardData = {
      wellnessScore: 78,
      completedExercises: 12,
      sleepQuality: 6.5,
      consistencyStreak: 7,
      totalXP: 150,
      moodData: {
        '2025-01-01': 'good',
        '2025-01-02': 'excellent',
        '2025-01-03': 'neutral',
        '2025-01-04': 'good',
        '2025-01-05': 'excellent',
        '2025-01-06': 'good',
        '2025-01-07': 'excellent'
      },
      activities: [
        { type: 'assessment', title: 'Completed Anxiety Assessment', time: '2 hours ago', xp: 20 },
        { type: 'meditation', title: 'Finished Meditation Session', time: 'Yesterday, 3:45 PM', xp: 15 },
        { type: 'reading', title: 'Read Article on Stress Management', time: '2 days ago', xp: 10 },
        { type: 'exercise', title: 'Completed CBT Exercise', time: '3 days ago', xp: 25 }
      ],
      goals: [
        { id: 1, title: 'Complete 3 meditation sessions', completed: 3, total: 3, checked: true, xp: 30 },
        { id: 2, title: 'Read 2 mental health articles', completed: 2, total: 2, checked: true, xp: 20 },
        { id: 3, title: 'Practice breathing exercises daily', completed: 4, total: 7, checked: false, xp: 35 },
        { id: 4, title: 'Sleep 7+ hours for 5 nights', completed: 3, total: 5, checked: false, xp: 25 }
      ]
    };

    // Check if user is logged in
    if (!localStorage.getItem('isLoggedIn')) {
      window.location.href = 'index.html';
    }
    
    // Load user data
    const userData = JSON.parse(localStorage.getItem('userData')) || {};
    
    // Set profile information
    document.getElementById('profileName').textContent = userData.name || 'User';
    
    // Set profile image based on name
    if (userData.name) {
      document.getElementById('profileImage').src = `https://ui-avatars.com/api/?name=${encodeURIComponent(userData.name)}&background=random`;
    }

    // Load dashboard data
    let dashboardData = JSON.parse(localStorage.getItem('dashboardData')) || defaultDashboardData;

    // Initialize dashboard with actual data
    function initializeDashboard() {
      // Update stats cards
      document.getElementById('wellnessScore').textContent = `${dashboardData.wellnessScore}/100`;
      document.getElementById('completedExercises').textContent = dashboardData.completedExercises;
      document.getElementById('sleepQuality').textContent = `${dashboardData.sleepQuality}h avg`;
      document.getElementById('consistencyStreak').textContent = `${dashboardData.consistencyStreak} days`;

      // Update progress level
      updateProgressLevel();
      
      // Update achievements
      updateAchievementsDisplay();

      // Update activities
      const activityList = document.getElementById('activityList');
      activityList.innerHTML = '';
      dashboardData.activities.forEach(activity => {
        const icons = {
          'assessment': 'fas fa-brain',
          'meditation': 'fas fa-spa',
          'reading': 'fas fa-book',
          'exercise': 'fas fa-tasks'
        };
        
        const activityItem = document.createElement('li');
        activityItem.className = 'activity-item';
        activityItem.innerHTML = `
          <div class="activity-icon">
            <i class="${icons[activity.type] || 'fas fa-check'}"></i>
          </div>
          <div class="activity-details">
            <div class="activity-title">${activity.title}</div>
            <div class="activity-time">${activity.time}</div>
          </div>
        `;
        activityList.appendChild(activityItem);
      });

      // Update goals
      const goalsList = document.getElementById('goalsList');
      goalsList.innerHTML = '';
      dashboardData.goals.forEach(goal => {
        const percentage = Math.round((goal.completed / goal.total) * 100);
        const goalItem = document.createElement('div');
        goalItem.className = 'goal-item';
        goalItem.innerHTML = `
          <div class="goal-checkbox">
            <input type="checkbox" id="goal${goal.id}" ${goal.checked ? 'checked' : ''} onchange="toggleGoal(${goal.id})">
          </div>
          <div class="goal-details">
            <div class="goal-title">${goal.title}</div>
            <div class="goal-progress">
              <div class="progress-bar">
                <div class="progress-fill" style="width: ${percentage}%"></div>
              </div>
              <div class="progress-text">${goal.completed}/${goal.total}</div>
            </div>
          </div>
        `;
        goalsList.appendChild(goalItem);
      });

      // Set today's mood
      const today = new Date().toISOString().split('T')[0];
      const todayMood = dashboardData.moodData[today];
      if (todayMood) {
        const moodItem = document.querySelector(`.mood-item[data-mood="${todayMood}"]`);
        if (moodItem) {
          moodItem.classList.add('active');
        }
      }

      // Initialize charts with actual data
      initializeCharts();
    }

    // Update progress level display
    function updateProgressLevel() {
      const currentLevel = progressSystem.getCurrentLevel(dashboardData.totalXP || 0);
      
      document.getElementById('levelBadge').textContent = currentLevel.name;
      document.getElementById('levelBadge').innerHTML = `<i class="${currentLevel.badge}"></i> ${currentLevel.name}`;
      
      if (currentLevel.nextLevel) {
        document.getElementById('nextLevel').textContent = currentLevel.nextLevel.name;
        document.getElementById('levelFill').style.width = `${currentLevel.progress * 100}%`;
        document.getElementById('currentXP').textContent = `${dashboardData.totalXP || 0} XP`;
        document.getElementById('nextLevelXP').textContent = `${currentLevel.nextLevel.xpRequired} XP for next level`;
      } else {
        document.getElementById('nextLevel').textContent = "Maximum Level!";
        document.getElementById('levelFill').style.width = '100%';
        document.getElementById('currentXP').textContent = `${dashboardData.totalXP || 0} XP`;
        document.getElementById('nextLevelXP').textContent = "You've reached the highest level!";
      }
    }

    // Update achievements display
    function updateAchievementsDisplay() {
      const updatedAchievements = progressSystem.updateAchievements(dashboardData);
      const badgeContainer = document.getElementById('badgeContainer');
      badgeContainer.innerHTML = '';
      
      updatedAchievements.forEach(achievement => {
        const badge = document.createElement('div');
        badge.className = `badge ${achievement.unlocked ? '' : 'locked'}`;
        badge.innerHTML = `
          <i class="${achievement.icon}"></i>
          <h4>${achievement.name}</h4>
          <p>${achievement.description}</p>
          ${achievement.unlocked ? `<small>+${achievement.xp} XP</small>` : '<small>Locked</small>'}
        `;
        badgeContainer.appendChild(badge);
      });
    }

    // Toggle goal completion
    function toggleGoal(goalId) {
      const goal = dashboardData.goals.find(g => g.id === goalId);
      if (goal) {
        goal.checked = !goal.checked;
        
        // Award XP when goal is completed
        if (goal.checked) {
          dashboardData.totalXP = (dashboardData.totalXP || 0) + (goal.xp || 10);
          dashboardData.completedExercises = (dashboardData.completedExercises || 0) + 1;
          
          // Add activity
          const now = new Date();
          const timeString = now.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });
          dashboardData.activities.unshift({
            type: 'exercise',
            title: `Completed: ${goal.title}`,
            time: `Today, ${timeString}`,
            xp: goal.xp || 10
          });
          
          // Keep only recent activities
          if (dashboardData.activities.length > 10) {
            dashboardData.activities = dashboardData.activities.slice(0, 10);
          }
          
          // Update wellness score
          dashboardData.wellnessScore = Math.min(100, dashboardData.wellnessScore + 2);
        }
        
        localStorage.setItem('dashboardData', JSON.stringify(dashboardData));
        initializeDashboard();
      }
    }

    // Initialize charts
    function initializeCharts() {
      // Progress Chart
      const progressCtx = document.getElementById('progressChart').getContext('2d');
      const progressChart = new Chart(progressCtx, {
        type: 'line',
        data: {
          labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
          datasets: [
            {
              label: 'Mood Score',
              data: [65, 70, 72, 75, 78, dashboardData.wellnessScore],
              borderColor: '#6a11cb',
              backgroundColor: 'rgba(106, 17, 203, 0.1)',
              tension: 0.4,
              fill: true
            },
            {
              label: 'Anxiety Level',
              data: [45, 42, 40, 38, 35, 100 - dashboardData.wellnessScore],
              borderColor: '#2575fc',
              backgroundColor: 'rgba(37, 117, 252, 0.1)',
              tension: 0.4,
              fill: true
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: true,
              max: 100
            }
          }
        }
      });

      // Mood History Chart
      const moodValues = Object.values(dashboardData.moodData).map(mood => {
        const moodScores = {
          'excellent': 90,
          'good': 75,
          'neutral': 60,
          'poor': 40,
          'very-poor': 20
        };
        return moodScores[mood] || 50;
      });

      const moodCtx = document.getElementById('moodChart').getContext('2d');
      const moodChart = new Chart(moodCtx, {
        type: 'bar',
        data: {
          labels: Object.keys(dashboardData.moodData).slice(-7),
          datasets: [{
            label: 'Daily Mood Score',
            data: moodValues.slice(-7),
            backgroundColor: 'rgba(106, 17, 203, 0.7)',
            borderColor: 'rgb(106, 17, 203)',
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: true,
              max: 100
            }
          }
        }
      });
    }

    // User profile dropdown
    const userProfile = document.getElementById('userProfile');
    const dropdownMenu = document.getElementById('dropdownMenu');
    
    userProfile.addEventListener('click', () => {
      dropdownMenu.classList.toggle('active');
    });
    
    // Close dropdown when clicking outside
    document.addEventListener('click', (e) => {
      if (!userProfile.contains(e.target)) {
        dropdownMenu.classList.remove('active');
      }
    });
    
    // Logout functionality
    document.getElementById('logoutBtn').addEventListener('click', (e) => {
      e.preventDefault();
      localStorage.removeItem('isLoggedIn');
      window.location.href = 'index.html';
    });

    // Mood selection
    const moodItems = document.querySelectorAll('.mood-item');
    moodItems.forEach(item => {
      item.addEventListener('click', () => {
        moodItems.forEach(i => i.classList.remove('active'));
        item.classList.add('active');
        
        // Save mood to dashboard data
        const mood = item.getAttribute('data-mood');
        const today = new Date().toISOString().split('T')[0];
        dashboardData.moodData[today] = mood;
        
        // Award XP for mood tracking
        dashboardData.totalXP = (dashboardData.totalXP || 0) + 5;
        
        // Update wellness score based on mood
        const moodImpact = {
          'excellent': 5,
          'good': 2,
          'neutral': 0,
          'poor': -2,
          'very-poor': -5
        };
        
        dashboardData.wellnessScore = Math.min(100, Math.max(0, dashboardData.wellnessScore + moodImpact[mood]));
        document.getElementById('wellnessScore').textContent = `${dashboardData.wellnessScore}/100`;
        
        // Add activity
        const now = new Date();
        const timeString = now.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });
        dashboardData.activities.unshift({
          type: 'assessment',
          title: `Mood recorded: ${mood}`,
          time: `Today, ${timeString}`,
          xp: 5
        });
        
        // Keep only recent activities
        if (dashboardData.activities.length > 10) {
          dashboardData.activities = dashboardData.activities.slice(0, 10);
        }
        
        localStorage.setItem('dashboardData', JSON.stringify(dashboardData));
        
        // Refresh dashboard
        initializeDashboard();
      });
    });

    // Time range filter
    document.getElementById('timeRange').addEventListener('change', function() {
      console.log('Time range changed to:', this.value);
    });

    const chatbaseToggle = document.getElementById('chatbaseToggle');
        chatbaseToggle.addEventListener('click', function() {
      this.classList.remove('pulse');
    });

    // Initialize dashboard when page loads
    document.addEventListener('DOMContentLoaded', initializeDashboard);
  </script>
</body>
</html>
